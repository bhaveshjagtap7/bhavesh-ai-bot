<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Bhavesh GPT</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        /* Custom styles for gradient background and effects */
        .gradient-bg {
            background: linear-gradient(135deg, #2a004a, #4b0082);
            height: 100vh;
            background-size: cover;
        }
        .chat-container {
            background: rgba(0, 0, 0, 0.7);
            border-radius: 20px;
            box-shadow: 0 0 20px rgba(0, 255, 255, 0.2);
        }
        .message-bubble {
            background: rgba(255, 255, 255, 0.1);
            border-radius: 15px;
            backdrop-filter: blur(5px);
            max-width: 70%;
        }
        .input-glow {
            transition: box-shadow 0.3s ease;
        }
        .input-glow:focus {
            box-shadow: 0 0 10px rgba(0, 255, 170, 0.5);
        }
        .fade-in {
            animation: fadeIn 0.5s ease-in;
        }
        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }
        .message-space {
            margin: 10px 0; /* Increased spacing between messages */
        }
    </style>
</head>
<body class="gradient-bg text-white flex items-center justify-center p-4">
    <div class="chat-container w-full max-w-md p-6">
        <div class="text-center mb-6">
            <h1 class="text-3xl font-bold text-purple-300 fade-in">Bhavesh GPT</h1>
            <p class="text-sm text-teal-200 fade-in">Advanced AI Assistant</p>
            <p class="text-green-400 text-xs mt-1 fade-in">Online</p>
        </div>
        <div class="chat-box h-96 overflow-y-auto mb-6 p-4 space-y-6"> <!-- Increased space-y-6 for more spacing -->
            <div id="messages"></div>
        </div>
        <div class="flex space-x-2">
            <input id="userInput" type="text" class="flex-1 p-2 rounded-lg bg-gray-800 text-white border border-teal-400 input-glow focus:outline-none" placeholder="Type your message here...">
            <button id="sendBtn" class="bg-purple-600 hover:bg-purple-700 text-white px-4 py-2 rounded-lg transition duration-300">Send</button>
        </div>
        <div class="text-xs text-gray-400 mt-2 text-center">
            <p>Press Enter to send • Open console (F12) for errors • Use a local server or Chrome with --disable-web-security for CORS</p>
        </div>
    </div>

    <script>
        const API_KEY = 'AIzaSyA33GrORogIzMQPbzkWF7nzcW2j-xSrwRI';
        const MODEL = 'gemini-2.5-flash';
        const API_URL = `https://generativelanguage.googleapis.com/v1beta/models/${MODEL}:generateContent`;

        let chatHistory = [];

        const messagesDiv = document.getElementById('messages');
        const userInput = document.getElementById('userInput');
        const sendBtn = document.getElementById('sendBtn');

        // Initial welcome message
        function addWelcomeMessage() {
            const welcomeMsg = document.createElement('div');
            welcomeMsg.className = 'message-bubble p-3 text-gray-300 fade-in message-space';
            welcomeMsg.innerHTML = 'Hello! I\'m BHAVESH GPT, your intelligent AI assistant. How can I help you today?';
            messagesDiv.appendChild(welcomeMsg);
            messagesDiv.scrollTop = messagesDiv.scrollHeight;
        }
        addWelcomeMessage();

        async function sendMessage() {
            const input = userInput.value.trim();
            if (!input) return;

            const userMessage = document.createElement('div');
            userMessage.className = 'message-bubble p-3 text-teal-200 fade-in message-space text-right';
            userMessage.textContent = input;
            messagesDiv.appendChild(userMessage);
            messagesDiv.scrollTop = messagesDiv.scrollHeight;

            chatHistory.push({ role: 'user', parts: [{ text: input }] });
            userInput.value = '';

            let statusDiv = document.createElement('div');
            statusDiv.className = 'text-center text-yellow-200 text-xs fade-in message-space';
            statusDiv.textContent = 'Bhavesh GPT is thinking...';
            messagesDiv.appendChild(statusDiv);
            messagesDiv.scrollTop = messagesDiv.scrollHeight;

            try {
                const response = await fetch(`${API_URL}?key=${API_KEY}`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        contents: chatHistory,
                        generationConfig: {
                            temperature: 0.7,
                            topP: 0.9,
                            maxOutputTokens: 512
                        }
                    })
                });

                if (!response.ok) {
                    const errorText = await response.text();
                    throw new Error(`HTTP ${response.status}: ${errorText}`);
                }

                const data = await response.json();

                if (!data.candidates?.[0]?.content?.parts?.[0]?.text) {
                    throw new Error('Invalid response from API');
                }

                const aiText = data.candidates[0].content.parts[0].text;

                chatHistory.push({ role: 'model', parts: [{ text: aiText }] });

                messagesDiv.removeChild(statusDiv);
                const aiMessage = document.createElement('div');
                aiMessage.className = 'message-bubble p-3 text-gray-300 fade-in message-space';
                aiMessage.innerHTML = formatMessage(aiText);
                messagesDiv.appendChild(aiMessage);
                messagesDiv.scrollTop = messagesDiv.scrollHeight;

            } catch (error) {
                console.error('API Error:', error);
                messagesDiv.removeChild(statusDiv);
                const errorMsg = `Error: ${error.message}. Check console (F12). Try: Verify API key at https://aistudio.google.com/app/apikey, enable Generative Language API in Google Cloud Console, or fix CORS (use local server or proxy).`;
                const errorDiv = document.createElement('div');
                errorDiv.className = 'message-bubble p-3 text-red-400 fade-in message-space';
                errorDiv.textContent = errorMsg;
                messagesDiv.appendChild(errorDiv);
                messagesDiv.scrollTop = messagesDiv.scrollHeight;
            }
        }

        function formatMessage(text) {
            return text
                .replace(/\n/g, '<br>')
                .replace(/\*\*(.*?)\*\*/g, '<strong>$1</strong>')
                .replace(/\*(.*?)\*/g, '<em>$1</em>');
        }

        sendBtn.addEventListener('click', sendMessage);
        userInput.addEventListener('keypress', (e) => {
            if (e.key === 'Enter') sendMessage();
        });
    </script>
</body>
</html>
